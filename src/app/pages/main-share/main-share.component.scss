:host, html, body { height: 100%; }
:host { display:block; }

/* Breakpoints & widths */
$bp-mobile: 768px;
$app-sb-w: 280px;          /* expanded desktop */
$app-sb-collapsed-w: 72px; /* collapsed desktop */

/* ===== GRID: sidebar + main (QUAN TRỌNG) ===== */
.app{
  --sbw: #{$app-sb-w};
  display: grid;
  grid-template-columns: var(--sbw) minmax(0,1fr);
  height: 100%;
  min-height: 0;
}
.app.sidebar-collapsed{ --sbw: #{$app-sb-collapsed-w};  .only-collapsed { display: grid !important; } /* nav-item dùng grid/flex đều ok */
  .only-expanded  { display: none !important; } }

/* ===== SIDEBAR (desktop) ===== */
.sidebar{
  /* không set width cố định desktop để cột grid co đúng */
  overflow: hidden;
  min-width: 0;
  background:#111; color:#ddd; border-right:1px solid var(--outline);
}
.sidebar .sidebar-inner{ height:100%; display:flex; flex-direction:column; }
.sb-header { display:flex; align-items:center; justify-content:space-between;
  overflow: visible;
padding-top:12px;
}
.brand{ display:flex; align-items:center; gap:10px; }
.brand-icon{ width:28px; height:28px; display:grid; place-items:center; background:#222; border-radius:8px; }
.brand-text{ font-weight:700; }
.collapse-btn{
  all: unset;
  display: grid;
  place-items: center;
  width: 28px; height: 28px;
  border-radius: 8px;
  cursor: pointer; color: #999;
}
.collapse-btn:hover{ background:#1b1b1b; color:#fff; }
.collapse-btn .chev{ width:18px; height:18px; transition: transform .2s ease; }

.sb-nav{ padding:8px; display:grid; gap:6px;  .nav-item.new-chat {
    place-items: center;
    /* giữ đúng kích thước & hiệu ứng như các icon khác */
    .icon { font-size: 18px; line-height: 1; }
  } }
.nav-item{ display:flex; align-items:center; gap:12px; padding:10px 12px; border-radius:8px; border:0; background:transparent; color:inherit; cursor:pointer; &:hover{ background:#202020; }
  .icon{ width:28px; text-align:center; }
  .text{ white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
}
/* Ẩn chữ khi collapsed (chỉ còn icon) */
.app.sidebar-collapsed .brand-text,
.app.sidebar-collapsed .sb-nav .text { display:none; }
.app.sidebar-collapsed .collapse-btn .chev{ transform: rotate(180deg); }
.app.sidebar-collapsed .collapse-btn{ margin-right: 2px; }


.app.sidebar-collapsed .icon-btn.plus{ display: none; }

/* ===== MAIN ===== */
.main{ display:flex; flex-direction:column; height:100%; min-height:0; overflow:hidden; position:relative; }
.topbar{ height:44px; display:flex; align-items:center; padding:0 12px; border-bottom:1px solid var(--outline); }
.hamburger{ display:none; background:transparent; border:1px solid var(--outline); border-radius:8px; padding:6px 10px; font-size:18px; cursor:pointer; color:var(--on-surface); }
.only-desktop{ display:inline-flex; } .only-mobile{ display:none; }

.chat-layout{ position:relative; display:flex; flex-direction:column; flex:1 1 auto; min-height:0; }
.chat-thread, app-chat-thread{ flex:1 1 auto; min-height:0; overflow:auto; }

/* HOME (no messages) */
.home-hero{
  flex: 1 1 auto;
  min-height: 0;
  display: grid;
  grid-template-rows: auto 1fr auto;   /* <-- đổi từ 1fr auto 1fr */
  justify-items: center;               /* căn giữa theo trục ngang */
  align-items: start;                  /* title bám top của hàng 1 */
  padding: 24px 16px;
  padding-bottom: max(24px, env(safe-area-inset-bottom));
    --prompt-h: 56px;
  --prompt-gap: max(24px, env(safe-area-inset-bottom));
}
.hero-center{
  position: absolute;
  inset: 0;
  /* chừa chỗ cho prompt ở đáy để tính giữa cho đúng */
  padding-bottom: calc(var(--prompt-h) + var(--prompt-gap));
  display: grid;
  place-items: center;        /* center ngang + dọc */
  pointer-events: none;       /* click xuyên qua */
}
/* Title ở hàng 1 (trên) */
.home-title{
  margin: 0;
  text-align: center;
  line-height: 1.2;
  opacity: .95;
  display: inline-flex;
  align-items: baseline;
  gap: 2px;
    padding: 0 12px;                 /* tránh dính mép */
  font-size: clamp(22px, 6vw, 40px);/* nhỏ hơn ở mobile */
}

.type-text {   white-space: normal;              /* <-- bỏ nowrap để cho phép wrap */
  word-break: break-word; }
.caret {
  display: inline-block;
  width: 2px;
  height: 1em;
  background: currentColor;
  transform: translateY(2px);
  animation: caretBlink 1s step-end infinite;
}
.home-prompt{
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
  bottom: var(--prompt-gap);
  width: min(820px, 92%);
  height: var(--prompt-h);
  display: flex; align-items: center; gap: 8px;
  padding: 8px;
  border-radius: 14px;
  background: var(--surface-container);
  border: 1px solid var(--outline);
  box-sizing: border-box;
}

.home-prompt #promptInput{ flex:1 1 auto; height:40px; line-height:40px; padding:0 10px; border:0; outline:none; background:transparent; color:var(--on-surface); }
.home-prompt .icon-btn{ width:40px; height:40px; display:grid; place-items:center; border:0; background:transparent; color:var(--on-surface); }
.home-prompt .badge{ position:absolute; top:-4px; right:-4px; min-width:16px; height:16px; padding:0 3px; display:inline-grid; place-items:center; background:var(--primary); color:#fff; border-radius:999px; font-size:10px; }

/* CHAT MODE prompt dính đáy */
.prompt-box{ flex:0 0 auto; padding:8px; border-top:1px solid var(--outline); background:var(--surface-container); }
.prompt{ display:flex; align-items:center; gap:8px; padding:6px 8px; border-radius:12px; background:var(--surface-container); border:1px solid var(--outline); }
#promptInput{ flex:1 1 auto; height:36px; line-height:36px; padding:0 8px; border:0; outline:none; background:transparent; color:var(--on-surface); }
.icon-btn{ position:relative; width:36px; height:36px; display:grid; place-items:center; border:0; background:transparent; color:var(--on-surface); border-radius:8px; cursor:pointer; }
.icon-btn svg{ width:20px; height:20px; }
.badge{ position:absolute; top:-4px; right:-4px; min-width:16px; height:16px; padding:0 3px; display:inline-grid; place-items:center; background:var(--primary); color:#fff; border-radius:999px; font-size:10px; }

/* ===== MOBILE: drawer ===== */
@media (max-width: $bp-mobile){
  .app{ grid-template-columns: 1fr; --sbw: 0; }
  .only-desktop{ display:none; } .only-mobile{ display:inline-flex; }
  .hamburger{ display:inline-flex; }

  .sidebar{
    position: fixed; top:0; bottom:0; left:0; z-index:1000;
    width: $app-sb-w;                    /* mobile dùng width cố định */
    transform: translateX(-100%);
    transition: transform .25s ease;
    box-shadow: 0 10px 30px rgba(0,0,0,.45);
  }
  .app.drawer-open .sidebar{ transform: translateX(0); }

  .backdrop{
    position: fixed; inset: 0; z-index: 900;
    background: rgba(0,0,0,.45);
    opacity: 0; pointer-events: none; transition: opacity .2s ease;
  }
  .app.drawer-open .backdrop{ opacity: 1; pointer-events: auto; }
}

.typewriter {
  /* custom props để dễ chỉnh */
  --chars: 0;            /* set từ template */
  --speed: 3.2s;         /* thời gian gõ */
  --delay: .2s;          /* trễ bắt đầu */

  display: inline-block;
  white-space: nowrap;
  overflow: hidden;
  width: 0ch;            /* bắt đầu từ 0 ký tự */
  border-right: 2px solid currentColor;   /* caret */

  animation:
    typing var(--speed) steps(var(--chars)) var(--delay) forwards,
    caretBlink 1s step-end var(--delay) infinite;
}

@keyframes typing {
  from { width: 0ch; }
  to   { width: var(--chars)ch; }
}
@keyframes caretBlink {
  50% { border-color: transparent; }
}

/* Tôn trọng reduced-motion của hệ điều hành */
@media (prefers-reduced-motion: reduce) {
  .typewriter {
    animation: none;
    width: auto;
    border-right: 0;
  }
}
@keyframes caretBlink { 50% { opacity: 0; } }

/* Tôn trọng reduced-motion */
@media (prefers-reduced-motion: reduce) {
  .caret { animation: none; }
}
@media (max-width: 768px){
  .home-prompt{ width: min(640px, 94%); }
}
@media (max-width: 480px){
  .home-prompt{ width: calc(100% - 24px); }
}

.sb-actions {
  display: flex;
  align-items: center;
  gap: 8px;
}
.icon-btn.plus{ all:unset; width:28px; height:28px; display:grid; place-items:center;
  border-radius:8px; cursor:pointer; color:#bbb; }
.icon-btn.plus:hover{ background:#1b1b1b; color:#fff; }
.sb-history{
  flex: 1 1 auto;
  overflow: auto;
  padding: 8px 6px 10px;
  border-top: 1px solid #222;
  margin-top: 8px;
}
.section-label{
  font-size: 12px; opacity: .6;
  padding: 6px 10px;
}

.history-list{ list-style: none; margin: 0; padding: 0; }
.history-row + .history-row{ margin-top: 2px; }

.h-item{
  width: 100%;
  display: grid;
  grid-template-columns: 18px 1fr auto;
  align-items: center;
  gap: 8px;
  padding: 6px 8px;
  height: 32px;                /* compact */
  font-size: 13px; line-height: 20px;
  background: transparent; border: 0; color: inherit;
  border-radius: 8px; text-align: left; cursor: pointer;
}
.h-item .dot{ font-size: 12px; opacity: .85; text-align: center; }
.h-item .text{
  overflow: hidden; text-overflow: ellipsis; white-space: nowrap;
}
.h-item .time{ font-size: 11px; opacity: .55; padding-left: 8px; }

.h-item:hover{ background: #1c1c1c; }
.h-item.active{
  background: #222; position: relative;
}
.h-item.active::before{
  content: ""; position: absolute; left: 0; top: 6px; bottom: 6px;
  width: 3px; border-radius: 2px; background: var(--primary);
}

/* Collapsed: chỉ còn icon, item cao hơn chút để dễ bấm */
.app.sidebar-collapsed .sb-history{ padding: 8px 4px; }
.app.sidebar-collapsed .section-label{ display: none; }
.app.sidebar-collapsed .h-item{
  grid-template-columns: 1fr;
  justify-items: center;
  height: 36px;
}
.app.sidebar-collapsed .h-item .text,
.app.sidebar-collapsed .h-item .time{ display: none; }
.app.sidebar-collapsed .h-item .dot{ font-size: 16px; }
@media (max-width: 768px){
  /* Khi mở drawer thì BẤT CHẤP collapsed, luôn hiện text/label/time */
  .app.drawer-open .brand-text,
  .app.drawer-open .sb-nav .text,
  .app.drawer-open .sb-history .text,
  .app.drawer-open .sb-history .time,
  .app.drawer-open .section-label { display: initial !important; }
}
/* visibility helpers */
.only-collapsed { display: none !important; }
.only-expanded  { display: inline-flex !important; }
.toolbar-btn {
  display: inline-flex;
  justify-content: center;
  align-items: center;
  width: 32px;          /* cố định khung */
  height: 32px;
  padding: 0;           /* tránh nhảy layout */
  border-radius: 10px;
  line-height: 1;       /* tránh baseline text làm lệch */
  border: 1px solid transparent;  /* tránh đổi kích thước khi hover */
  background: var(--surface-2, #1b1b1b);
  color: var(--text-1, #e6e6e6);
  transition: background .15s ease, border-color .15s ease, transform .05s ease;
  cursor: pointer;

  svg {
    display: block;     /* không lấy baseline font */
    width: 16px;
    height: 16px;
    pointer-events: none;
  }

  &:hover:not(:disabled) {
    background: var(--surface-3, #222);
    border-color: var(--outline, #2b2b2b);
  }

  &:active:not(:disabled) {
    transform: translateY(1px);
  }

  &:disabled,
  &[aria-disabled="true"] {
    opacity: .4;
    cursor: default;
    pointer-events: none;
  }
}

/* Tùy chọn: xoay chevron khi expanded để trực quan hơn */
.toolbar-btn svg.rotated {
  transform: rotate(180deg);
  transition: transform .15s ease;
}
/* === History actions === */

.h-item.edit-mode { grid-template-columns: 20px 1fr auto; }

.rename-input {
  width: 100%;
  min-height: 30px;
  padding: 4px 10px;
  border-radius: 8px;
  background: rgba(255,255,255,.04);
  border: 1px solid var(--outline, #333);

  /* Quan trọng: chữ sáng + caret cùng màu */
  color: var(--text-strong, #e8e8e8);
  caret-color: currentColor;

  outline: none;
  transition: border-color .15s ease, box-shadow .15s ease;

  &::placeholder { color: var(--text-dim, #9aa0a6); opacity: .85; }
  &:focus {
    border-color: #6ea8fe;
    box-shadow: 0 0 0 2px rgba(110,168,254,.25);
  }
}
.row-actions {
  display: flex;
  gap: 6px;
  opacity: 0;
  pointer-events: none;
  transition: opacity .15s ease;
}
.history-row:hover .row-actions,
.h-item.active + .row-actions,
.h-item.edit-mode + .row-actions { opacity: 1; pointer-events: auto; }

.icon-btn.sm {
  width: 26px; height: 26px; border-radius: 8px;
  display: inline-grid; place-items: center;
  background: transparent; border: 1px solid transparent;
}
.icon-btn.sm:hover { background: rgba(255,255,255,.06); border-color: rgba(255,255,255,.08); }
.icon-btn.sm.danger:hover { color: #f36; border-color: rgba(243, 102, 102, .4); }

/* Ẩn actions khi sidebar đang collapse để tiết kiệm không gian */
.sidebar-collapsed .row-actions { display: none; }

/* Override bố cục hàng history: 1fr | auto */
.history-row {
  display: grid !important;
  grid-template-columns: minmax(0, 1fr) auto; /* item | actions */
  align-items: center;
  column-gap: 8px;
}


/* Chặn autofill tô trắng (Chrome) */
input.rename-input:-webkit-autofill,
input.rename-input:-webkit-autofill:hover,
input.rename-input:-webkit-autofill:focus {
  -webkit-text-fill-color: var(--text-strong, #e8e8e8);
  -webkit-box-shadow: 0 0 0 1000px var(--surface, #151515) inset;
  box-shadow: 0 0 0 1000px var(--surface, #151515) inset;
}

/* (tuỳ chọn) nếu bạn muốn nền input trong vắt */
.dark .rename-input { background: transparent; }
