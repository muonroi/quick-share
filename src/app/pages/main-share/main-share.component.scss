:host, html, body { height: 100%; }
:host { display:block; }

/* Breakpoints & widths */
$bp-mobile: 768px;
$app-sb-w: 280px;          /* expanded desktop */
$app-sb-collapsed-w: 72px; /* collapsed desktop */

/* ===== GRID: sidebar + main (QUAN TRỌNG) ===== */
.app{
  --sbw: #{$app-sb-w};
  display: grid;
  grid-template-columns: var(--sbw) minmax(0,1fr);
  height: 100%;
  min-height: 0;
}
.app.sidebar-collapsed{ --sbw: #{$app-sb-collapsed-w}; }

/* ===== SIDEBAR (desktop) ===== */
.sidebar{
  /* không set width cố định desktop để cột grid co đúng */
  overflow: hidden;
  min-width: 0;
  background:#111; color:#ddd; border-right:1px solid var(--outline);
}
.sidebar .sidebar-inner{ height:100%; display:flex; flex-direction:column; }
.sb-header { display:flex; align-items:center; justify-content:space-between;  padding: 12px 10px 12px 12px;  /* <-- thêm padding-right */
  overflow: visible;             /* tránh crop icon trong header */}
.brand{ display:flex; align-items:center; gap:10px; }
.brand-icon{ width:28px; height:28px; display:grid; place-items:center; background:#222; border-radius:8px; }
.brand-text{ font-weight:700; }
.collapse-btn{
  all: unset;
  display: grid;
  place-items: center;
  width: 28px; height: 28px;
  border-radius: 8px;
  cursor: pointer; color: #999;
}
.collapse-btn:hover{ background:#1b1b1b; color:#fff; }
.collapse-btn .chev{ width:18px; height:18px; transition: transform .2s ease; }

.sb-nav{ padding:8px; display:grid; gap:6px; }
.nav-item{ display:flex; align-items:center; gap:12px; padding:10px 12px; border-radius:8px; border:0; background:transparent; color:inherit; cursor:pointer; &:hover{ background:#202020; }
  .icon{ width:28px; text-align:center; }
  .text{ white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
}
/* Ẩn chữ khi collapsed (chỉ còn icon) */
.app.sidebar-collapsed .brand-text,
.app.sidebar-collapsed .sb-nav .text { display:none; }
.app.sidebar-collapsed .collapse-btn .chev{ transform: rotate(180deg); }
.app.sidebar-collapsed .collapse-btn{ margin-right: 2px; }


.app.sidebar-collapsed .icon-btn.plus{ display: none; }

/* ===== MAIN ===== */
.main{ display:flex; flex-direction:column; height:100%; min-height:0; overflow:hidden; position:relative; }
.topbar{ height:44px; display:flex; align-items:center; padding:0 12px; border-bottom:1px solid var(--outline); }
.hamburger{ display:none; background:transparent; border:1px solid var(--outline); border-radius:8px; padding:6px 10px; font-size:18px; cursor:pointer; color:var(--on-surface); }
.only-desktop{ display:inline-flex; } .only-mobile{ display:none; }

.chat-layout{ position:relative; display:flex; flex-direction:column; flex:1 1 auto; min-height:0; }
.chat-thread, app-chat-thread{ flex:1 1 auto; min-height:0; overflow:auto; }

/* HOME (no messages) */
.home-hero{
  flex: 1 1 auto;
  min-height: 0;
  display: grid;
  grid-template-rows: auto 1fr auto;   /* <-- đổi từ 1fr auto 1fr */
  justify-items: center;               /* căn giữa theo trục ngang */
  align-items: start;                  /* title bám top của hàng 1 */
  padding: 24px 16px;
  padding-bottom: max(24px, env(safe-area-inset-bottom));
    --prompt-h: 56px;
  --prompt-gap: max(24px, env(safe-area-inset-bottom));
}
.hero-center{
  position: absolute;
  inset: 0;
  /* chừa chỗ cho prompt ở đáy để tính giữa cho đúng */
  padding-bottom: calc(var(--prompt-h) + var(--prompt-gap));
  display: grid;
  place-items: center;        /* center ngang + dọc */
  pointer-events: none;       /* click xuyên qua */
}
/* Title ở hàng 1 (trên) */
.home-title{
  margin: 0;
  text-align: center;
  font-size: clamp(26px, 4.5vw, 40px);
  line-height: 1.2;
  opacity: .95;
  display: inline-flex;
  align-items: baseline;
  gap: 2px;
}

.type-text { white-space: nowrap; }
.caret {
  display: inline-block;
  width: 2px;
  height: 1em;
  background: currentColor;
  transform: translateY(2px);
  animation: caretBlink 1s step-end infinite;
}
.home-prompt{
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
  bottom: var(--prompt-gap);
  width: min(820px, 92%);
  height: var(--prompt-h);
  display: flex; align-items: center; gap: 8px;
  padding: 8px;
  border-radius: 14px;
  background: var(--surface-container);
  border: 1px solid var(--outline);
  box-sizing: border-box;
}

.home-prompt #promptInput{ flex:1 1 auto; height:40px; line-height:40px; padding:0 10px; border:0; outline:none; background:transparent; color:var(--on-surface); }
.home-prompt .icon-btn{ width:40px; height:40px; display:grid; place-items:center; border:0; background:transparent; color:var(--on-surface); }
.home-prompt .badge{ position:absolute; top:-4px; right:-4px; min-width:16px; height:16px; padding:0 3px; display:inline-grid; place-items:center; background:var(--primary); color:#fff; border-radius:999px; font-size:10px; }

/* CHAT MODE prompt dính đáy */
.prompt-box{ flex:0 0 auto; padding:8px; border-top:1px solid var(--outline); background:var(--surface-container); }
.prompt{ display:flex; align-items:center; gap:8px; padding:6px 8px; border-radius:12px; background:var(--surface-container); border:1px solid var(--outline); }
#promptInput{ flex:1 1 auto; height:36px; line-height:36px; padding:0 8px; border:0; outline:none; background:transparent; color:var(--on-surface); }
.icon-btn{ position:relative; width:36px; height:36px; display:grid; place-items:center; border:0; background:transparent; color:var(--on-surface); border-radius:8px; cursor:pointer; }
.icon-btn svg{ width:20px; height:20px; }
.badge{ position:absolute; top:-4px; right:-4px; min-width:16px; height:16px; padding:0 3px; display:inline-grid; place-items:center; background:var(--primary); color:#fff; border-radius:999px; font-size:10px; }

/* ===== MOBILE: drawer ===== */
@media (max-width: $bp-mobile){
  .app{ grid-template-columns: 1fr; --sbw: 0; }
  .only-desktop{ display:none; } .only-mobile{ display:inline-flex; }
  .hamburger{ display:inline-flex; }

  .sidebar{
    position: fixed; top:0; bottom:0; left:0; z-index:1000;
    width: $app-sb-w;                    /* mobile dùng width cố định */
    transform: translateX(-100%);
    transition: transform .25s ease;
    box-shadow: 0 10px 30px rgba(0,0,0,.45);
  }
  .app.drawer-open .sidebar{ transform: translateX(0); }

  .backdrop{
    position: fixed; inset: 0; z-index: 900;
    background: rgba(0,0,0,.45);
    opacity: 0; pointer-events: none; transition: opacity .2s ease;
  }
  .app.drawer-open .backdrop{ opacity: 1; pointer-events: auto; }
}

.typewriter {
  /* custom props để dễ chỉnh */
  --chars: 0;            /* set từ template */
  --speed: 3.2s;         /* thời gian gõ */
  --delay: .2s;          /* trễ bắt đầu */

  display: inline-block;
  white-space: nowrap;
  overflow: hidden;
  width: 0ch;            /* bắt đầu từ 0 ký tự */
  border-right: 2px solid currentColor;   /* caret */

  animation:
    typing var(--speed) steps(var(--chars)) var(--delay) forwards,
    caretBlink 1s step-end var(--delay) infinite;
}

@keyframes typing {
  from { width: 0ch; }
  to   { width: var(--chars)ch; }
}
@keyframes caretBlink {
  50% { border-color: transparent; }
}

/* Tôn trọng reduced-motion của hệ điều hành */
@media (prefers-reduced-motion: reduce) {
  .typewriter {
    animation: none;
    width: auto;
    border-right: 0;
  }
}
@keyframes caretBlink { 50% { opacity: 0; } }

/* Tôn trọng reduced-motion */
@media (prefers-reduced-motion: reduce) {
  .caret { animation: none; }
}
@media (max-width: 768px){
  .home-prompt{ width: min(640px, 94%); }
}
@media (max-width: 480px){
  .home-prompt{ width: calc(100% - 24px); }
}

.sb-actions { display:flex; align-items:center; gap:6px; }
.icon-btn.plus{ all:unset; width:28px; height:28px; display:grid; place-items:center;
  border-radius:8px; cursor:pointer; color:#bbb; }
.icon-btn.plus:hover{ background:#1b1b1b; color:#fff; }
.sb-history{
  flex: 1 1 auto;
  overflow: auto;
  padding: 8px 6px 10px;
  border-top: 1px solid #222;
  margin-top: 8px;
}
.section-label{
  font-size: 12px; opacity: .6;
  padding: 6px 10px;
}

.history-list{ list-style: none; margin: 0; padding: 0; }
.history-row + .history-row{ margin-top: 2px; }

.h-item{
  width: 100%;
  display: grid;
  grid-template-columns: 18px 1fr auto;
  align-items: center;
  gap: 8px;
  padding: 6px 8px;
  height: 32px;                /* compact */
  font-size: 13px; line-height: 20px;
  background: transparent; border: 0; color: inherit;
  border-radius: 8px; text-align: left; cursor: pointer;
}
.h-item .dot{ font-size: 12px; opacity: .85; text-align: center; }
.h-item .text{
  overflow: hidden; text-overflow: ellipsis; white-space: nowrap;
}
.h-item .time{ font-size: 11px; opacity: .55; padding-left: 8px; }

.h-item:hover{ background: #1c1c1c; }
.h-item.active{
  background: #222; position: relative;
}
.h-item.active::before{
  content: ""; position: absolute; left: 0; top: 6px; bottom: 6px;
  width: 3px; border-radius: 2px; background: var(--primary);
}

/* Collapsed: chỉ còn icon, item cao hơn chút để dễ bấm */
.app.sidebar-collapsed .sb-history{ padding: 8px 4px; }
.app.sidebar-collapsed .section-label{ display: none; }
.app.sidebar-collapsed .h-item{
  grid-template-columns: 1fr;
  justify-items: center;
  height: 36px;
}
.app.sidebar-collapsed .h-item .text,
.app.sidebar-collapsed .h-item .time{ display: none; }
.app.sidebar-collapsed .h-item .dot{ font-size: 16px; }
